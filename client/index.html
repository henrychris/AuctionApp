<!DOCTYPE html>
<html>
  <head>
    <title>SignalR Client</title>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"
      integrity="sha512-7rhBJh1om/W5Ztx7WiYOR9h2wlSaTmPyQMoHFtbT/FVNIA12y6S6I8HY9mrBS1uJ3dSU/R3qaSAXsGYuRjMDxg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>
  <body style="font-family: Roboto, serif">
    <div
      id="homeScreen"
      style="display: flex; flex-direction: column; gap: 5px"
    >
      <h1>SignalR Client</h1>
      <input type="text" id="userName" placeholder="Username" />
      <input type="text" id="roomName" placeholder="Room" />
      <button id="joinRoom">Join Room</button>
    </div>

    <div id="chatScreen" style="display: none">
      <h1 id="roomTitle"></h1>
      <div id="messages"></div>
      <div>
        <input
          type="text"
          id="messageInput"
          placeholder="Message"
          autocomplete="off"
        />
      </div>
    </div>

    <script>
      const connection = new signalR.HubConnectionBuilder()
        .withAutomaticReconnect()
        .withUrl("http://localhost:5030/chatHub")
        .build();

      connection.start().catch(function (err) {
        return console.error(err.toString());
      });

      document
        .getElementById("joinRoom")
        .addEventListener("click", function () {
          const roomName = document.getElementById("roomName").value;
          const userName = document.getElementById("userName").value;
          connection.invoke("JoinRoom", userName, roomName);
          document.getElementById("homeScreen").style.display = "none";
          document.getElementById("chatScreen").style.display = "block";
          document.getElementById("roomTitle").innerHTML = roomName;
          document.getElementById("messageInput").focus();
        });

      document
        .getElementById("messageInput")
        .addEventListener("keyup", function (event) {
          if (event.key === "Enter") {
            const message = document.getElementById("messageInput").value;
			console.log(`message: ${message}`);
            const roomName = document.getElementById("roomName").value;
			console.log(`roomName: ${roomName}`);
            if (message && roomName) {
              connection.invoke("SendMessageToRoom", roomName, message);
              document.getElementById("messageInput").value = "";
            }
          }
        });

      connection.on("ReceiveMessage", function (msg) {
        const messages = document.getElementById("messages");
        const user = `<span style="font-weight: bold">${msg.chatUser}: </span>`;
        messages.innerHTML += `<p>${user}<span>${msg.text}</span></p>`;
      });

      connection.on("UserJoined", function (msg) {
        const messages = document.getElementById("messages");
        const user = `<span style="font-weight: bold">${msg} </span>`;
        messages.innerHTML += `<p style="color:grey">${user}has joined.</p>`;
      });

      connection.on("UserLeft", function (msg) {
        const messages = document.getElementById("messages");
        const user = `<span style="font-weight: bold">${msg} </span>`;
        messages.innerHTML += `<p style="color:grey">${user}has left.</p>`;
      });
    </script>
  </body>
</html>
